title: 关于一分类排序算法
date: 2016-12-06 18:44:12
permalink: category
tags:
- 算法
categories: 
- 前端
---

算法一直是一个程序员的必备技能，以前前端涉及到算法的地方并不是很多，一般在后端进行数据处理与数据分类的时候会要求用到一个算法，随着前端技术发展与前端工程变化之后，前端需要用到的算法也会越来越多，前端不再是处理简单的交互，更多的是要处理业务逻辑。。。
<!-- more -->
而这些逻辑往往会或多或少的带有算法，并且用的最多的就是排序，但是目前前端主流框架都带有简单的排序功能，比如angularjs就有过滤器，但是对于更加复杂的逻辑还是需要自己去写过滤器。目前我在项目中用的最多的在后端传回数据给我的时候，我需要把数据进行分类，因为后端基本不给我处理这些，只给回原始的数据。

## 需求
后端传回来的原始数据
{% codeblock %}
  <xml>
    <data name="hzxx"><!--患者信息-->
      <row>
        <!-- 病人编号 -->
        <userid>12344</userid>
        <!-- 就诊编号 本次的-->
        <currentnum>12233456787</currentnum>
        <!-- 姓名 -->
        <name>刘德华</name>
        <!-- 出生年月日 -->
        <birth>1990/10/10</birth>
        <!-- 电话 -->
        <phone>12345678911</phone>
        <!-- 地址 -->
        <address>广东省深圳市南山区</address>
        <!-- 过敏药物 -->
        <drug>敌敌畏，鹤顶红</drug>
        <!-- 其他信息 -->
        <otherinfo>无</otherinfo>
      </row>
    </data>
    <data name="wwcsj"><!--未完成数据-->
      <row>
        <!--  首诊编号  operation number-->
        <opernum>12345</opernum>
        <!-- 行号 row number-->
        <rownum>1</rownum>
        <!-- 项目编号project number -->
        <pronum>1234577</pronum>
        <!-- 项目名称 project name -->
        <proname>拔牙</proname>
        <!-- 病程序号 case num -->
        <casenum>1</casenum>
        <!-- 当前病程 -->
        <currcase>粘托槽</currcase>
        <case>
          <row>方案</row>
          <row>粘托槽</row>
          <row>方案</row>
          <row>粘托槽</row>
        </case>
        <!-- 牙位 tooth position-->
        <toothpos></toothpos>
        <!-- 单位 -->
        <dw></dw>
        <!-- 单价 price-->
        <price>1000</price>
        <!-- 数量 -->
        <num>1</num>
        <!-- 合计 total price -->
        <totalpri>1000</totalpri>
        <!-- 优惠金额 discount price -->
        <discprice>100</discprice>
        <!-- 小计 subtotal -->
        <subtotal>1000</subtotal>
        <!-- 欠款 owe -->
        <owe></owe>
      </row>
      <row>.....</row>
        ....
      <row>.....</row>
      <row>.....</row>
      <row>.....</row>
    </data>
  </xml>
{% endcodeblock %}
先用{% link x2js库 https://github.com/abdmob/x2js true x2js库 %}将xml转成json，然后将他们分类，每条xml数据都有俩个data节点，第一个data节点(name='hzxx')里面的是患者的基本信息，第二个data节点(name='wwcsj')包裹着的是每个患者所做的项目，每个项目里面又包含着N个进程，data节点下面的每个每个row节点是一个进程，每个项目中都有对应唯一的首诊编号与行号，现在要根据每个row节点中的opernum(首诊编号)与rownum(行号),取出row节点中相同项目中的子进程(如下图)。
{% img /images/top.png 600 400 img  %}
由图需求可知，就是行为单位将进行进行分类，属于相同行的进程分到一起
取出结果
{% img /images/top_appcate.png 400 600 img  %}
## 实现代码
{% codeblock %}
var queryProject = function (data) {
 // body...
 var  obj = [];
 if(Array.isArray(data.row)){
   let dataLists = data.row;
   for(let i =0;i<dataLists.length;i++){
     var row = [];
     row.push(dataLists[i])
     let currentData = dataLists[i];
     dataLists.splice(i,1);
     i--;
     for(let j=0;j<dataLists.length;j++){
       if((currentData.opernum == dataLists[j].opernum) && ( currentData.rownum == dataLists[j].rownum )){
         row.push(dataLists[j])
         dataLists.splice(j,1);
         j--;
       }
     }
     obj.push(row);
   }
 }else{
     obj.push(data)
 }
 console.log(obj)
 return obj;
}
{% endcodeblock %}
这段代码是先进行类型判断，然后进入一次循环，定义一个缓存数组row，之后将第i次循环的元素放进row中，保存当前第i个元素currentData，然后在原数组中删去第i个数组,那么原数组中只剩arr.length-1个元素，进入第二次循环，将刚删去的第i个元素与剩下arr.length-1个元素的每个进行比较，然后取出相同的，，如果有就扔进row中，之后在从原数组中删除该元素，最后将row扔进obj中，在进行第一次循环。

### 难点
在这个分类中，每进行一次第一次外围循环都要将第i个数组从原数组中删，然后与剩下的元素进行比较，接下来每进行一次第二次内部循环对比，如果有一样的都要将该元素扔进row中缓存，然后删改元素，最后将row扔进obj中，每次进行外围循环都要将缓存row清空。
### 性能
如图
{% img /images/ppp12.png 600 400 img  %}
如果有9个row的数据而且每个row的数据都不相同，那么要进行循环的最大次数是8+7+6+5+4+3+2+1=36次